# Unsatisfactory Reproduction
For several executions, Botsing has terminated the search process and declares a successful reproduction.
However after manual analyses, we decide to consider those generated test cases as __unsatisfactory__.
Frame __LANG-6b-1__ is one example.
It has been _reproduced_ exactly once by configuration [__IA-control__], but not by [__IA__].
The input stack trace of it is shown in __[Listing 1](#listing-1-stack-trace-for-lang-6b)__, while the test case generated by the control group is shown in __[Listing 2](#listing-2-generated-test-case-for-lang-6b-1)__.
__[Listing 3](#listing-3-source-code-of-the-translate-method-from-the-first-frame)__ contains the source code of the `translate` method from the first frame of the stack trace.

#### Listing 1: Stack Trace for LANG-6b
``` log
java.lang.StringIndexOutOfBoundsException: String index out of range: 2
  at org.apache.commons.lang3.text.translate.CharSequenceTranslator.translate(CharSequenceTranslator.java:95)
  at org.apache.commons.lang3.text.translate.CharSequenceTranslator.translate(CharSequenceTranslator.java:59)
  at org.apache.commons.lang3.StringEscapeUtils.escapeCsv(StringEscapeUtils.java:556)
```

#### Listing 2: Generated Test Case for LANG-6b-1
``` java 
1 | @Test(timeout = 4000)
2 | public void test0() throws Throwable {
3 |     CharSequenceTranslator charSequenceTranslator0 = mock(CharSequenceTranslator.class, CALLS_REAL_METHODS);
4 |     doReturn(3663).when(charSequenceTranslator0).translate(any(java.lang.CharSequence.class), anyInt(), any(java.io.Writer.class));
5 |     tringWriter stringWriter0 = new StringWriter(609);
6 |     // Undeclared exception!
7 |     charSequenceTranslator0.translate((CharSequence) "261", (Writer) stringWriter0);
8 | }
```

#### Listing 3: Source code of the `translate` method from the first frame
``` java
75 | public final void translate(CharSequence input, Writer out) throws IOException {
76 |   if (out == null) {
77 |     throw new IllegalArgumentException("The Writer must not be null");
78 |   }
79 |   if (input == null) {
80 |     return;
81 |   }
82 |   int pos = 0;
83 |   int len = input.length();
84 |   while (pos < len) {
85 |     int consumed = translate(input, pos, out);
86 |     if (consumed == 0) {
87 |       char[] c = Character.toChars(Character.codePointAt(input, pos));
88 |       out.write(c);
89 |       pos+= c.length;
90 |       continue;
91 |     }
92 |   // contract with translators is that they have to understand codepoints
93 |   // and they just took care of a surrogate pair
94 |     for (int pt = 0; pt < consumed; pt++) {
95 |       pos += Character.charCount(Character.codePointAt(input, pos));
96 |     }
97 |   }
98 | }
```

The `translate(CharSequence, int, Writer)` method is stubbed at line 4 of __[Listing 2](#listing-2-generated-test-case-for-lang-6b-1)__ to return `3663` for any parameter.
Originally, it should return the count of codepoints consumed with the invocation.
Notice that this is neither the same `translate` method from the first frame, nor the one from the second frame of the stack trace.
However, it is invoked at line 85 of the `translate` method from the first frame, see __[Listing 3](#listing-3-source-code-of-the-translate-method-from-the-first-frame)__.
Later, at line 94, the returned value is used as the boundary when accessing the `CharSequence`.
The forged value `3663` therefore inevitably results in an `StringIndexOutOfBoundsException` being thrown at line 95, reproducing the target frame.

Botsing treated it as a valid solution and terminated the search process.
However, the method would not return such a value if it was not stubbed.
The generated test case is far-fetched and does not reveal any information about the bug either.
Therefore the crash should not be considered reproduced.

We have identified 73 unsatisfactory reproductions for configuration [__IA__], 65 for [__IA-control__] respectively out of 3,840 runs.
With Fisher's exact test, the resulting _p_-value is _0.5478_.
For configuration [__BV__], 182 unsatisfactory reproductions have been identified out of 7,380 runs, and 194 for [__BV-control__].
With Fisher's exact test we have _p = 0.5656_.
Therefore, Botsing's behaviour of generating unsatisfactory reproductions is not related to our proposed methods and it is out of the scope of this thesis project to investigate the reason behind this behaviour.